{% extends 'base_content.html' %}
{% block content %}
    <section>
        <h2>Student Requests</h2>
        <table class="request-table">
            <tr>
                <th>Student Name</th>
                <th>Subject</th>
                <th>Frequency</th>
                <th>Preferred Time</th>
                <th>Details</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
            {% for request in student_requests %}
            <tr>
                <td>{{ request.student.first_name }} {{ request.student.last_name }}</td>
                <td>{{ request.subject }}</td>
                <td>{{ request.frequency }}</td>
                <td>{{ request.preferred_time }}</td>
                <td>{{ request.additional_details }}</td>
                <td>{{ request.status }}</td>
                <td>
                    <a href="{% url 'pair_request' request.id 0 %}">Pair</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7">No student requests available.</td>
            </tr>
            {% endfor %}
        </table>
    </section>

    <section>
        <h2>Tutor Requests</h2>
        <table class="request-table">
            <tr>
                <th>Tutor Name</th>
                <th>Languages</th>
                <th>Available Time</th>
                <th>Details</th>
            </tr>
            {% for request in tutor_requests %}
            <tr>
                <td>{{ request.tutor.first_name }} {{ request.tutor.last_name }}</td>
                <td>{{ request.languages }}</td>
                <td>{{ request.available_time }}</td>
                <td>{{ request.additional_details }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4">No tutor requests available.</td>
            </tr>
            {% endfor %}
        </table>
    </section>

    <section>
        <h2>Lesson Scheduling</h2>
        <table class="lesson-scheduling">
            <tr>
                <th>Tutor Name</th>
                <th>Student Name</th>
                <th>Subject</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Frequency</th>
                <th>Status</th>
            </tr>
            {% for lesson in lessons %}
            <tr>
                <td>{{ lesson.tutor.first_name }} {{ lesson.tutor.last_name }}</td>
                <td>{{ lesson.student.first_name }} {{ lesson.student.last_name }}</td>
                <td>{{ lesson.subject }}</td>
                <td>{{ lesson.start_time }}</td>
                <td>{{ lesson.end_time }}</td>
                <td>{{ lesson.frequency }}</td>
                <td>{{ lesson.status }}</td>
                <td>
                    <a href="{% url 'edit_lesson' lesson.id %}">Edit</a> | 
                    <a href="{% url 'delete_lesson' lesson.id %}" onclick="return confirm('Are you sure?')">Delete</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="10">No lessons scheduled.</td>
            </tr>
            {% endfor %}
        </table>
    </section>

    <section>
        <h2>Invoices and Payments</h2>
        <table>
            <tr>
                <th>Student Name</th>
                <th>Tutor Name</th>
                <th>Invoice ID</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
            {% for invoice in invoices %}
            <tr>
                <td>{{ invoice.student.full_name }}</td>
                <td>{{ invoice.tutor.user.full_name }}</td>
                <td>{{ invoice.id }}</td>
                <td>{{ invoice.amount }}</td>
                <td>{{ invoice.status }}</td>
                <td>
                    <a href="{% url 'view_invoice' invoice.id %}">View</a> | 
                    <a href="{% url 'mark_paid' invoice.id %}">Mark as Paid</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">No invoices available.</td>
            </tr>
            {% endfor %}
        </table>
    </section>

    <section>
        <h2>Analytics</h2>
        <ul>
            <li>Total Tutors: {{ analytics.total_tutors }}</li>
            <li>Total Students: {{ analytics.total_students }}</li>
            <li>Total Hours Taught: {{ analytics.hours_taught }}</li>
        </ul>
    </section>
{% endblock %}
