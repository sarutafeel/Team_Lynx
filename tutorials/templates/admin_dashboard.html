{% extends 'base_content.html' %}
{% block content %}
    <section>
        <h2>Requests</h2>
        <table>
            <tr>
                <th>Student Name</th>
                <th>Request Type</th>
                <th>Priority</th>
                <th>Status</th>
                <th>Allocated</th>
                <th>Actions</th>
            </tr>
            {% for request in requests %}
            <tr>
                <td>{{ request.student.name }}</td>
                <td>{{ request.type }}</td>
                <td>{{ request.priority }}</td>
                <td>{{ request.status }}</td>
                <td>{{ request.allocated|yesno:"Yes,No" }}</td>
                <td>
                    <a href="{% url 'allocate_request' request.id %}">Allocate</a> | 
                    <a href="{% url 'message_student' request.student.id %}">Message</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">No requests available.</td>
            </tr>
            {% endfor %}
        </table>
    </section>

    <section>
        <h2>Lesson Scheduling</h2>
        <table>
            <tr>
                <th>Tutor Name</th>
                <th>Subject</th>
                <th>Availability</th>
                <th>Actions</th>
            </tr>
            {% for tutor in tutors %}
            <tr>
                <td>{{ tutor.user.full_name }}</td>
                <td>{{ tutor.subject }}</td>
                <td>{{ tutor.availability }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4">No tutors available.</td>
            </tr>
            {% endfor %}
        </table>
    </section>

    <section>
        <h2>Invoices and Payments</h2>
        <table>
            <tr>
                <th>Student Name</th>
                <th>Tutor Name</th>
                <th>Invoice ID</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
            {% for invoice in invoices %}
            <tr>
                <td>{{ invoice.student.user.full_name }}</td>
                <td>{{ invoice.tutor.user.full_name }}</td>
                <td>{{ invoice.id }}</td>
                <td>{{ invoice.amount }}</td>
                <td>{{ invoice.status }}</td>
                <td>
                    <a href="{% url 'view_invoice' invoice.id %}">View</a> | 
                    <a href="{% url 'mark_paid' invoice.id %}">Mark as Paid</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">No invoices available.</td>
            </tr>
            {% endfor %}
        </table>
    </section>

    <section>
        <h2>Analytics</h2>
        <ul>
            <li>Total Tutors: {{ analytics.total_tutors }}</li>
            <li>Total Students: {{ analytics.total_students }}</li>
            <li>Total Hours Taught: {{ analytics.hours_taught }}</li>
        </ul>
    </section>

    <section>
        <h2>Create Invoice</h2>
        <form method="post" action="{% url 'create_invoice' %}">
            {% csrf_token %}
            <label for="student">Student:</label>
            <select name="student" id="student">
                {% for student in students %}
                    <option value="{{ student.id }}">{{ student.user.full_name }}</option>
                {% endfor %}
            </select>
            <label for="tutor">Tutor:</label>
            <select name="tutor" id="tutor">
                {% for tutor in tutors %}
                    <option value="{{ tutor.id }}">{{ tutor.user.full_name }}</option>
                {% endfor %}
            </select>
    
            <label for="amount">Amount:</label>
            <input type="number" step="0.01" name="amount" id="amount" required>
    
            <label for="due_date">Due Date:</label>
            <input type="date" name="due_date" id="due_date" required>
    
            <button type="submit">Create Invoice</button>
        </form>
    </section>    
{% endblock %}
